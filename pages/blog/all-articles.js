// components
import Head from 'next/head';
// -- custom
import HeroImage from '../../components/HeroImage/HeroImage';
import DecoratedHeading from '../../components/DecoratedHeading/DecoratedHeading';
import ArticlePreviewList from '../../components/ArticlePreviewList/ArticlePreviewList';

// styles
import styles from '../../styles/pages/AllArticles.module.scss';

// constants
import { STRAPI_URL } from '../../constants';
import { GET_ARTICLES_BY_NEWEST_FIRST } from '../../graphql/queries';

export default function AllArticles({ articles }) {
  return (
    <>
      <Head>
        <title>All Articles | FreeRoam</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <HeroImage
        title="Blog"
        src="/all-articles-header.jpg"
        alt="Person relaxing on beach reading book"
      />

      <main className={styles['all-articles']}>
        <DecoratedHeading level="2" text="All Articles" />
        <ArticlePreviewList articles={articles} />
      </main>
    </>
  );
}

export async function getStaticProps() {
  const fetchOptions = {
    method: 'POST',
    headers: {
      'content-type': 'application/json',
    },
    body: JSON.stringify({
      query: GET_ARTICLES_BY_NEWEST_FIRST,
    }),
  };
  const response = await fetch(`${STRAPI_URL}/graphql`, fetchOptions);
  const result = await response.json();

  const { articles } = result.data;

  return {
    props: {
      articles: articles.data,
    },
  };
}
